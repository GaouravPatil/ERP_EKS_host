{% extends 'base.html' %}

{% block title %}My Classes - MIT-WPU College ERP{% endblock %}

{% block extra_css %}
<style>
.class-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    border-left: 4px solid #007bff;
}
.class-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15)!important;
}
.subject-badge {
    font-size: 0.75rem;
    margin: 2px;
}
.student-count {
    background: linear-gradient(45deg, #28a745, #20c997);
    color: white;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}
.class-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">My Classes</h1>
                    <p class="mb-0 text-muted">Manage your assigned classes and students</p>
                </div>
                <div>
                    <a href="{% url 'teachers:dashboard' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card class-header shadow text-center h-100">
                <div class="card-body">
                    <i class="bi bi-people-fill" style="font-size: 2rem;"></i>
                    <h4 class="mt-2">{{ classes|length }}</h4>
                    <p class="mb-0">Total Classes</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success text-white shadow text-center h-100">
                <div class="card-body">
                    <i class="bi bi-person-check-fill" style="font-size: 2rem;"></i>
                    <h4 class="mt-2">
                        {% widthratio classes|length 1 1 %}
                        {% comment %}This would sum up all student counts{% endcomment %}
                        --
                    </h4>
                    <p class="mb-0">Total Students</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info text-white shadow text-center h-100">
                <div class="card-body">
                    <i class="bi bi-book-fill" style="font-size: 2rem;"></i>
                    <h4 class="mt-2">
                        {{ taught_subjects.count|default:"--" }}
                    </h4>
                    <p class="mb-0">Subjects Teaching</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning text-white shadow text-center h-100">
                <div class="card-body">
                    <i class="bi bi-calendar-week-fill" style="font-size: 2rem;"></i>
                    <h4 class="mt-2">--</h4>
                    <p class="mb-0">Classes This Week</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Classes Grid -->
    {% if classes %}
    <div class="row">
        {% for class_info in classes %}
        <div class="col-lg-6 col-md-12 mb-4">
            <div class="card class-card shadow h-100">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">{{ class_info.class_obj.name }}</h5>
                            <p class="mb-0 text-muted">
                                {{ class_info.class_obj.department.name }} - Semester {{ class_info.class_obj.semester }}
                            </p>
                        </div>
                        <div class="student-count">
                            {{ class_info.student_count }}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Class Details -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <small class="text-muted">Section</small>
                            <div class="fw-bold">{{ class_info.class_obj.section }}</div>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Academic Year</small>
                            <div class="fw-bold">{{ class_info.class_obj.academic_year }}</div>
                        </div>
                    </div>

                    <!-- Subjects Teaching -->
                    <div class="mb-3">
                        <small class="text-muted d-block mb-2">Subjects Teaching:</small>
                        <div>
                            {% for subject in class_info.subjects %}
                            <span class="badge bg-primary subject-badge">
                                {{ subject.course.code }}
                            </span>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Class Teacher Badge -->
                    {% if class_info.class_obj.class_teacher == request.user %}
                    <div class="mb-3">
                        <span class="badge bg-success">
                            <i class="bi bi-star-fill"></i> Class Teacher
                        </span>
                    </div>
                    {% endif %}

                    <!-- Quick Stats -->
                    <div class="row text-center mb-3">
                        <div class="col-4">
                            <div class="border-end">
                                <h6 class="text-primary mb-0">{{ class_info.student_count }}</h6>
                                <small class="text-muted">Students</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border-end">
                                <h6 class="text-success mb-0">{{ class_info.subjects|length }}</h6>
                                <small class="text-muted">Subjects</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <h6 class="text-info mb-0">--</h6>
                            <small class="text-muted">Avg Score</small>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2">
                        <a href="{% url 'teachers:attendance' %}?subject={{ class_info.subjects.0.id }}" 
                           class="btn btn-primary btn-sm flex-fill">
                            <i class="bi bi-check-square"></i> Attendance
                        </a>
                        <button type="button" class="btn btn-outline-success btn-sm flex-fill" 
                                data-bs-toggle="modal" data-bs-target="#studentsModal{{ class_info.class_obj.id }}">
                            <i class="bi bi-people"></i> Students
                        </button>
                        <a href="{% url 'teachers:timetable' %}" class="btn btn-outline-info btn-sm flex-fill">
                            <i class="bi bi-calendar"></i> Schedule
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Student List Modals -->
    {% for class_info in classes %}
    <div class="modal fade" id="studentsModal{{ class_info.class_obj.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        {{ class_info.class_obj.name }} - Student List
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Class Details:</strong> 
                        {{ class_info.class_obj.department.name }} - Semester {{ class_info.class_obj.semester }} - Section {{ class_info.class_obj.section }}
                    </div>
                    
                    {% comment %}
                    <!-- This would show actual students in the class -->
                    <!-- For now, showing placeholder -->
                    {% endcomment %}
                    <div class="text-center py-4">
                        <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
                        <h5 class="text-muted mt-3">{{ class_info.student_count }} Students Enrolled</h5>
                        <p class="text-muted">Student list functionality will be available in the complete system.</p>
                        <div class="mt-3">
                            <a href="{% url 'teachers:attendance' %}?subject={{ class_info.subjects.0.id }}" 
                               class="btn btn-primary me-2">
                                <i class="bi bi-check-square"></i> Mark Attendance
                            </a>
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

    {% else %}
    <!-- No Classes State -->
    <div class="card shadow">
        <div class="card-body text-center py-5">
            <i class="bi bi-people text-muted" style="font-size: 4rem;"></i>
            <h4 class="text-muted mt-3">No Classes Assigned</h4>
            <p class="text-muted">You don't have any classes assigned yet. Please contact the administration for class assignments.</p>
            <div class="mt-4">
                <a href="{% url 'teachers:dashboard' %}" class="btn btn-primary">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Class Quick Actions Modal -->
<div class="modal fade" id="quickActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Quick Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'teachers:attendance' %}" class="btn btn-primary">
                        <i class="bi bi-check-square"></i> Mark Attendance
                    </a>
                    <a href="{% url 'teachers:grades' %}" class="btn btn-success">
                        <i class="bi bi-award"></i> Manage Grades
                    </a>
                    <a href="{% url 'teachers:exams' %}" class="btn btn-info">
                        <i class="bi bi-clipboard-check"></i> Manage Exams
                    </a>
                    <a href="{% url 'teachers:timetable' %}" class="btn btn-warning">
                        <i class="bi bi-calendar"></i> View Timetable
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

// Show quick actions modal
function showQuickActions() {
    var modal = new bootstrap.Modal(document.getElementById('quickActionsModal'));
    modal.show();
}
</script>
{% endblock %}